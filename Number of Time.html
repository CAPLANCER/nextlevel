import re
import pdfplumber

PDF_PATH = "YourFile.pdf"
OUTPUT_PATH = "Call_Records.txt"

# ==========================
# ✅ KEYWORDS
# ==========================

UNIVERSAL_CALL_KEYWORDS = [
    "CALL",
    "CALLS",
    "VOICE CALL",
    "LOCAL CALLS",
    "OUTGOING CALLS",
    "INCOMING CALLS",
    "ITEMISED CALLS",
    "ITEMIZED CALLS",
    "S.no Date Time Number Duration",
    "Date Time Number Duration",
    "Duration",
    "HH:MM:SS"
]

VI_KEYWORDS = [
    "Itemised Calls",
    "Outgoing calls",
    "Date - Time Number Duration",
    "Usage Details",
    "Call Charges"
]

AIRTEL_KEYWORDS = [
    "YOUR ITEMIZED STATEMENT",
    "Local Calls",
    "S.no Date Time Number Duration",
    "HH:MM:SS",
    "Pulse Amount"
]

# ✅ All call-related keywords
CALL_KEYWORDS = [*UNIVERSAL_CALL_KEYWORDS, *VI_KEYWORDS, *AIRTEL_KEYWORDS]

# ✅ Keywords to ignore
EXCLUDE_KEYWORDS = [
    "SMS",
    "MESSAGES",
    "INTERNET",
    "DATA",
    "KB",
    "MB",
    "GB",
    "VALUE ADDED SERVICES",
    "PLAN CHARGES",
    "SUMMARY",
    "ACCOUNT SUMMARY",
    "PAYMENT",
    "CHARGES"
]

# ==========================
# ✅ REGEX PATTERNS
# ==========================

duration_pattern = r"\b\d{2}:\d{2}:\d{2}\b"
number_pattern = r"\b\d{7,12}\b"

call_records = []

with pdfplumber.open(PDF_PATH) as pdf:
    for page in pdf.pages:
        text = page.extract_text()
        if not text:
            continue

        for line in text.split("\n"):
            uline = line.upper()

            # ✅ Skip unwanted sections
            if any(word in uline for word in EXCLUDE_KEYWORDS):
                continue

            # ✅ Check keyword or numeric patterns
            has_keyword = any(word.upper() in uline for word in CALL_KEYWORDS)
            has_patterns = (
                re.search(duration_pattern, line) and 
                re.search(number_pattern, line)
            )

            if has_keyword or has_patterns:
                call_records.append(line.strip())

# ==========================
# ✅ EXPORT TO TEXT FILE
# ==========================

with open(OUTPUT_PATH, "w", encoding="utf-8") as f:
    f.write("=== CALL RECORDS ===\n\n")
    for record in call_records:
        f.write(record + "\n")

print(f"\n✅ Export Complete!")
print(f"Saved to: {OUTPUT_PATH}")
print(f"Total Records: {len(call_records)}")
