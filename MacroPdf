import re

def extract_call_records(file_path, provider):
    """
    Extracts call records from a text file based on the provider's specific headers/keywords.
    
    Args:
        file_path (str): Path to the text file.
        provider (str): 'jio', 'airtel', or 'vi'.
    """
    extracted_lines = []
    capture = False
    
    # Define rules for each provider
    # 'start_triggers': Keywords that mark the beginning of a relevant section
    # 'stop_triggers': Keywords that mark the end of a section
    # 'section_headers': Specific headers for Airtel/VI to look for to start capturing
    
    provider = provider.lower()
    
    try:
        with open(file_path, 'r', encoding='utf-8') as file:
            for line in file:
                # Clean the line (remove extraction tags if any exist)
                clean_line = re.sub(r'\[source: \d+\]', '', line).strip()
                
                # --- JIO LOGIC ---
                if provider == 'jio':
                    # START Condition: "Voice" (but not "Voice Total" or summary headers like "Voice Call")
                    if "Voice" in clean_line and "Voice Total" not in clean_line and "Voice Call" not in clean_line:
                        # Ensure we capture the section header "2.0 Voice" or just "Voice"
                        if "2.0" in clean_line or clean_line == "Voice":
                            capture = True
                    
                    if capture:
                        extracted_lines.append(clean_line)
                    
                    # STOP Condition: "Voice Total"
                    if "Voice Total" in clean_line:
                        capture = False

                # --- AIRTEL LOGIC ---
                elif provider == 'airtel':
                    # Headers that indicate a call record section is starting
                    airtel_headers = [
                        "local calls", "to fixedline", "to cug", 
                        "to airtel mobile", "to other mobiles"
                    ]
                    
                    # Check if the line matches one of the known headers
                    if any(header in clean_line.lower() for header in airtel_headers):
                        capture = True
                        extracted_lines.append(clean_line) # Keep the header for context
                        continue
                    
                    if capture:
                        # STOP Condition Heuristics for Airtel:
                        # 1. Line contains "Total" (usually ends a section)
                        # 2. Line contains "Grand Total"
                        # 3. Line is completely empty (often separates sections in text extracts)
                        if "Total" in clean_line or "Grand Total" in clean_line:
                            extracted_lines.append(clean_line) # Capture the total line
                            capture = False
                        elif clean_line == "":
                            # Optional: Stop on empty lines if your text file is sparse
                            # Comment out the line below if your records have gaps
                            capture = False 
                        else:
                            extracted_lines.append(clean_line)

                # --- VI LOGIC ---
                elif provider == 'vi':
                    vi_headers = ["outgoing calls", "std"]
                    
                    if any(header in clean_line.lower() for header in vi_headers):
                        capture = True
                        extracted_lines.append(clean_line)
                        continue
                        
                    if capture:
                        # STOP Condition Heuristics for VI:
                        if "Total" in clean_line or "Grand Total" in clean_line:
                            extracted_lines.append(clean_line)
                            capture = False
                        elif clean_line == "":
                             # Assuming sections are separated by whitespace
                            capture = False
                        else:
                            extracted_lines.append(clean_line)

        return extracted_lines

    except FileNotFoundError:
        return [f"Error: The file '{file_path}' was not found."]

# --- Usage Examples ---

# 1. For Jio
# records = extract_call_records('ExtractedText.txt', 'jio')

# 2. For Airtel
# records = extract_call_records('Airtel_Bill.txt', 'airtel')

# 3. For VI
# records = extract_call_records('VI_Bill.txt', 'vi')

# --- Wrapper to print results ---
def process_and_print(file_name, provider_name):
    print(f"--- Extracting {provider_name.upper()} records from {file_name} ---")
    data = extract_call_records(file_name, provider_name)
    
    if data and "Error" not in data[0]:
        print("\n".join(data))
        # Optional: Save to file
        # with open(f'{provider_name}_extracted.txt', 'w', encoding='utf-8') as f:
        #     f.write("\n".join(data))
    else:
        print(data[0] if data else "No records found matching the keywords.")

# Example execution (Uncomment to run if you have files)
# process_and_print('ExtractedText.txt', 'jio')
