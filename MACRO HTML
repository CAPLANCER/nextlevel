import requests
import json

# --- CONFIGURATION ---
API_KEY = "YOUR_ACTUAL_API_KEY_HERE"
FILE_PATH = "your_document.pdf" 

# --- PROXY CONFIGURATION ---
# Replace with your specific proxy details. 
# If you have a username/password, use: "http://user:password@proxyip:port"
proxies = {
    "http": "http://10.10.1.10:3128",  # Example IP and Port
    "https": "http://10.10.1.10:3128",
}

# --- STEP 1: UPLOAD ---
upload_url = f"https://generativelanguage.googleapis.com/upload/v1beta/files?key={API_KEY}"

files = {'file': (FILE_PATH, open(FILE_PATH, 'rb'), 'application/pdf')}

print("Uploading file via proxy...")
# Added proxies=proxies here
response_1 = requests.post(upload_url, files=files, proxies=proxies)

if response_1.status_code != 200:
    print(f"Upload failed: {response_1.text}")
    exit()

file_uri = response_1.json()['file']['uri']
print(f"File uploaded: {file_uri}")

# --- STEP 2: GENERATE ---
generate_url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key={API_KEY}"

payload = {
    "contents": [{
        "role": "user",
        "parts": [
            {"fileData": {"mimeType": "application/pdf", "fileUri": file_uri}},
            {"text": "Analyze this document."}
        ]
    }]
}

headers = {'Content-Type': 'application/json'}

print("Generating content via proxy...")
# Added proxies=proxies here
response_2 = requests.post(generate_url, headers=headers, json=payload, proxies=proxies)

if response_2.status_code == 200:
    print(response_2.json())
else:
    print(f"Error: {response_2.text}")
