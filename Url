import requests
import os
import mimetypes
import json
import urllib3
from urllib3.exceptions import InsecureRequestWarning

# ---------------- CONFIG ----------------
API_KEY = "YOUR_API_KEY"
FILE_PATH = "input.txt"

UPLOAD_URL = f"https://generativelanguage.googleapis.com/upload/v1beta/files?key={API_KEY}"
# ---------------------------------------

# ðŸ”‡ Suppress SSL warnings (explicit & intentional)
urllib3.disable_warnings(InsecureRequestWarning)


def upload_text_file(file_path):
    if not os.path.exists(file_path):
        raise FileNotFoundError(file_path)

    mime_type, _ = mimetypes.guess_type(file_path)
    mime_type = mime_type or "text/plain"

    metadata = {
        "file": {
            "display_name": os.path.basename(file_path)
        }
    }

    with open(file_path, "rb") as f:
        files = {
            "metadata": (
                None,
                json.dumps(metadata),
                "application/json"
            ),
            "file": (
                os.path.basename(file_path),
                f,
                mime_type
            )
        }

        response = requests.post(
            UPLOAD_URL,
            files=files,
            verify=False  # ðŸ”´ SSL verification disabled
        )

    response.raise_for_status()
    result = response.json()

    return result["file"]["uri"]


if __name__ == "__main__":
    uri = upload_text_file(FILE_PATH)
    print("âœ… File uploaded successfully")
    print("ðŸ“„ File URI:", uri)
