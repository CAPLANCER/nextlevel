import requests
import os
import urllib3

# ==========================================
# 1. CONFIGURATION
# ==========================================
API_KEY = "YOUR_ACTUAL_API_KEY_HERE"
FILE_PATH = "your_file.txt"  # <--- Ensure this points to your text file
PROXY_URL = "http://10.10.1.10:3128" # Your Organization Proxy

# ==========================================
# 2. PROXY & SSL SETUP
# ==========================================
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# Force Python to use the proxy
os.environ['HTTP_PROXY'] = PROXY_URL
os.environ['HTTPS_PROXY'] = PROXY_URL

proxies = {
    "http": PROXY_URL,
    "https": PROXY_URL,
}

def get_file_uri():
    url = f"https://generativelanguage.googleapis.com/upload/v1beta/files?key={API_KEY}"
    
    print(f"--- Starting Upload for '{FILE_PATH}' ---")

    # Set MIME Type specifically for text files
    mime_type = 'text/plain' 

    try:
        with open(FILE_PATH, 'rb') as f:
            # We explicitly tell Google this is a text/plain file
            files = {'file': (FILE_PATH, f, mime_type)}
            
            # verify=False bypasses SSL errors
            response = requests.post(url, files=files, proxies=proxies, verify=False, timeout=60)
        
        if response.status_code == 200:
            result = response.json()
            file_uri = result['file']['uri']
            print(f"âœ… Upload Successful!")
            print(f"ðŸ“‚ File URI: {file_uri}")
            return file_uri
        else:
            print(f"âŒ Upload Failed: {response.status_code}")
            print(f"Reason: {response.text}")
            return None

    except Exception as e:
        print(f"âŒ Connection/Proxy Error: {e}")
        return None

if __name__ == "__main__":
    uri = get_file_uri()
    input("\nPress Enter to exit...")
