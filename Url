import requests
import os
import urllib3

# --- CONFIGURATION ---
API_KEY = "YOUR_ACTUAL_API_KEY_HERE"
PROXY_URL = "http://10.10.1.10:3128" 

# --- SETUP ---
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
os.environ['HTTP_PROXY'] = PROXY_URL
os.environ['HTTPS_PROXY'] = PROXY_URL
proxies = {"http": PROXY_URL, "https": PROXY_URL}

print("--- DIAGNOSTIC TEST ---")

try:
    # 1. Simple connectivity test to Google (Not the API yet)
    print("1. Testing connection to google.com...")
    response = requests.get("https://www.google.com", proxies=proxies, verify=False, timeout=10)
    print(f"   Status Code: {response.status_code}")
    
    if response.status_code == 200:
        print("   ✅ Internet connection working.")
    else:
        print("   ❌ Internet test failed.")
        print(f"   Response Content: {response.text[:200]}") # Print first 200 chars

    # 2. Testing the API Endpoint (HEAD request just to check access)
    print("\n2. Testing API Endpoint reachability...")
    api_url = f"https://generativelanguage.googleapis.com/upload/v1beta/files?key={API_KEY}"
    
    # We send a dummy POST without a file just to see if the server replies
    response_api = requests.post(api_url, proxies=proxies, verify=False, timeout=10)
    
    print(f"   Status Code: {response_api.status_code}")
    print(f"   Raw Response Text: '{response_api.text}'") # <--- THIS IS KEY

except Exception as e:
    print(f"\n❌ CRITICAL ERROR: {e}")
